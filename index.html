<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M"
        crossorigin="anonymous">
    <style>
        body {
            background-color: rgb(245, 245, 245);
        }

        h1 {
            color: rgb(34, 34, 34);
        }

        #bar {
            background-color: rgb(29, 29, 29);
        }

        .text {
            color: rgb(255, 255, 255);
        }

        #buses {
            background-color: rgb(105, 105, 105);
        }

        .ySpacer {
            background-color: rgb(255, 255, 255);
            height: 0.1em;
            border-radius: 1em;
        }

    </style>
</head>

<body>
    <div class="content">
        <h1 id="fromTo">Where - Somewhere</h1>
        <form id="locations" action="#">
            <label for="start">From:</label>
            <input type="text" id="start">
            <label for="end">To:</label>
            <input type="text" id="end">
            <input type="submit" id="send" value="Go">
        </form>
        <div class="container-fluid" id="bar">
            <div class="row text">
                <div class="col-2">Bus</div>
                <div class="col-2">From</div>
                <div class="col-2">To</div>
                <div class="col-2">Time until there</div>
                <div class="col-2">Walk distance</div>
            </div>
        </div>
        <div class="ySpacer"></div>
        <div class="container-fluid" id="buses">
            <div class="row">

            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js">
    </script>

    <script>
        jQuery(function ($) {
            var $busTable = $('#buses');
            var $locForm = $('#locations');
            var set = false;

            $locForm.submit(function (e) {
                e.preventDefault();
                var url = 'http://localhost:3001/set'
                var start = $('#start').val();
                var end = $('#end').val();

                $.post(url, { "start": start, "end": end }, function (response) {
                }, 'json').then(function (data) {
                    $('#start').val('');
                    $('#end').val('');
                    $('#fromTo').html(start + "-" + end)
                    set = true;
                    showData(data);
                });
            })

            function showData(data) {
                console.log('trying')
                $busTable.html('');
                var items = [];
                var wd = data.walkDistance + "m";
                var from = data.ss;
                var to = data.es;
                var bus = data.bus;
                var tut = data.wholeTime + "min";
                if (data.wholeTime < 0) {
                    wd = '-'
                    from = '-'
                    to = '-'
                    tut = '-'
                    bus = '-'
                }
                html = `<div class="row refresh text">
                                 <div class="col-2">`
                    + bus +
                    `</div>
                                <div class="col-2">`
                    + from +
                    `</div>
                                <div class="col-2">`
                    + to +
                    `</div>
                                <div class="col-2">`
                    + tut +
                    `</div>
                                <div class="col-2">`
                    + wd +
                    `</div>
                            </div>`
                items.push(html);
                $('#buses').append(items.join(""))
            }

            function getData() {
                if (set) {
                    var url = 'http://localhost:3001/data'
                    $.getJSON(url, function (data) {
                        showData(data);
                    }).then(function (data) {
                        setTimeout(getData, 10000);
                    }).catch(function (err) {
                        console.log('Unhandled error.')
                    });
                }
            };
            
        });

    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
        crossorigin="anonymous"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1"
        crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
        crossorigin="anonymous"></script>

</body>

</html>